<!DOCTYPE html>
<html>
  <head>
    <title>Dublin AR</title>
    <meta name="description" content="Dublin AR">


	<!--needed for Edge-->
	<script src="https://cdn.jsdelivr.net/npm/fast-text-encoding@1.0.0/text.min.js"></script>


	<!--stable version 0.8.0 | Dev version 0.9.0 | Local version 0.8.2 -->
	 <script src="https://aframe.io/releases/0.9.0/aframe.min.js"></script>
	<!--<script src="js/aframe.min.js"></script>
	<script src="js/aframe.min.js.map"></script>-->

	<!--DEV Version AR.Js 1.6.3 LOCAL-->
	<!--<script src="js/aframe-ar.js"></script>-->

	<!--May 2019 Version AR.Js 1.7.1-->
	<script src="https://cdn.rawgit.com/jeromeetienne/AR.js/1.7.1/aframe/build/aframe-ar.js"></script>

	<script src="https://unpkg.com/aframe-potree-loader-component/dist/aframe-potree-loader-component.min.js"></script>




	<script src="js/markermanagerDublin.js"></script>


	<script>
  AFRAME.registerComponent('modify-materials', {
    init: function () {
      // Wait for model to load.
      this.el.addEventListener('model-loaded', () => {
        // Grab the mesh / scene.
        const obj = this.el.getObject3D('mesh');

        // Go over the submeshes and modify materials we want.
        obj.traverse(node => {


			node.material=new THREE.MeshBasicMaterial({colorWrite: false});
          console.log('ciao');
        });
      });
    }
  });
</script>


	<!--
	<script>


	AFRAME.registerComponent('chmat',
	{
	init:function(){

	this.el.addEventListener('model-loaded', (e) => {
	var obj = this.el.getObject3D('mesh').material;
	console.log(obj);

	obj.traverse(node => {
          if (node.name.indexOf('ship') !== -1) {
            node.material.color.set('red');
          }});

	});
	}

	//el.getObject3D('mesh').material= new THREE.MeshBasicMaterial({colorWrite: false});


	});
	</script>
	-->

	</head>

	<body>

	<!-- add to a-scene arjs="" debugUIEnabled: false;-->
	<a-scene vr-mode-ui="enabled: false" color-space="sRGB" renderer="gammaOutput: true" embedded arjs='debugUIEnabled: false; sourceType: webcam; patternRatio: 0.85; trackingMethod: best;'>

	<a-assets markInit>

		 <a-asset-item id="Obj-obj" src="resource/Object.obj"></a-asset-item>
		 <a-asset-item id="Obj-mtl" src="resource/Object.mtl"></a-asset-item>

		 <a-asset-item id="frame-obj" src="resource/frame.obj"></a-asset-item>
		 <a-asset-item id="frame-mtl" src="resource/frame.mtl"></a-asset-item>

		 <a-asset-item id="planeHole-obj" src="resource/PlaneHole.obj"></a-asset-item>
		 <a-asset-item id="win" src="resource/window.gltf"></a-asset-item>
     <video id="Video" src="resource/Dublin_castle1915.mp4" loop webkit-playsinline playsinline ></video>

	</a-assets>




	<!--Markers-->


	<!--3D model - PointCloud Dublin-->
	<a-marker  type="pattern" url="resource/markers/pattern-Individual_Blocks-1.patt" id='markerswords' registerevents >
	<!--the plane must be on the top, render order is important-->
		<a-obj-model  modify-materials  position="0 0 0" scale="1 1 1" src="#planeHole-obj"  ></a-obj-model>

		<a-obj-model position="0 0 0" scale="1 1 1" src="#Obj-obj" mtl="#Obj-mtl" material="shader:flat;"></a-obj-model>

		<a-obj-model position="0 0 0" scale="1 1 1" src="#frame-obj" mtl="#frame-mtl"></a-obj-model>

    <!--<a-video src="#Video"  scale="1 1 1" rotation="-90 0 0" position="0 -0.5 0" height="2" width="4" material="shader:flat;"></a-video>-->

  <!--
		<a-box scale="0.5 0.5 0.5" scale="1 1 1" position="0 -0.5 0" color="blue" rotation="0 0 0"
		animation="property: rotation; to: 360 360 0; loop: true; dur: 10000"
		animation__2="property: position; from: 0.5 -0.5 0; to: -1 -0.5 0; dir:alternate; loop:true; dur:5000" >
  </a-box>-->





		<!--
		 <a-entity potree-loader="
        src: resource/dub10;
        pointBudget: 10000000;

        pointSize: 2;
        pointColorType: rgb;
        minimumNodePixelSize: 1;
        "
        position="2.5 1 1"
        rotation="-90 0 -145"
		scale="1 1 1"
      ></a-entity>
	  -->



	</a-marker>




	<a-entity camera>
		<a-cursor> </a-cursor>
	</a-entity>



	</a-scene>




	<script>

	AFRAME.registerComponent('box', {
  schema: {
    width: {type: 'number', default: 1},
    height: {type: 'number', default: 1},
    depth: {type: 'number', default: 1},
    color: {type: 'color', default: '#AAA'}
  },

  init: function () {
    var data = this.data;
    var el = this.el;
    this.geometry = new THREE.BoxBufferGeometry(data.width, data.height, data.depth);
    //this.material = new THREE.MeshStandardMaterial({color: data.color});
	this.material = new THREE.MeshBasicMaterial({colorWrite: false});


    this.mesh = new THREE.Mesh(this.geometry, this.material);
    el.setObject3D('mesh', this.mesh);
  }});
	</script>



	 <script>
	 /*
		var sceneEl = document.querySelector('a-scene');

		var videoChroma = document.querySelector('#chromaVideo');
		var videoMocap = document.querySelector('#mocapVideo');

		if(videoChroma.paused==false)
		{
		videoChroma.muted=false;
		videoChroma.pause();

		}

		if(videoMocap.paused==false)
		{
		videoMocap.muted=false;
		videoMocap.pause();
		}
		*/
		</script>






	</body>

	</html>
